<!DOCTYPE html>
<html>
<head>

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>

<meta name="keywords" content="ethernet 16-axis controller, cnc control, motion control, cnc boards, 4-axis, 8-axis, stepper, brushless, DC motor, servo, encoder, adc, dac, motion controller, automated motion, manufacturing, Mach3">
<meta name="description" content="Manufacturer of premium motion control products for CNC Manufacturing, Robotics and Automation">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta http-equiv="Content-Language" content="en-us">

<title>Step Response Screen</title>

<link rel="stylesheet" type="text/css" href="../css/style.css">
<link rel="stylesheet" href="../css/prism.css" data-noprefix />
<script src="../js/prism.js"></script>
</head>

<body>

<div id="logo"><a href="../index.htm"></a></div>

<div id="home">
<a href="../index.htm">Table of contents</a> |  
	<script>
		if (navigator.userAgent.indexOf("NT 6.2") == -1){
			document.write('<a href="https://www.dynomotion.com">Dynomotion home page</a>')
		} else {
			document.write('<a href="https://www.dynomotion.com" target="_blank">Dynomotion home page</a>')
		}
	</script>
</div>
	
<div id="searchNav">

	<div class="gcse-search">
					<script>
					  if (document.location.protocol  ==  'https:') {
					  (function() {
					  var cx = '012657033059195044748:9fmjmlufts0';
					  var gcse = document.createElement('script');
					  gcse.type = 'text/javascript';
					  gcse.async = true;
					  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					      '//cse.google.com/cse.js?cx=' + cx;
					  var s = document.getElementsByTagName('script')[0];
					  s.parentNode.insertBefore(gcse, s);
					})();
					  }
				      </script> 
				      <gcse:search> </gcse:search>  

	       </div>
</div>	

	


<div id="google_translate_element" style="background: transparent;" align="right"><script type="text/javascript">
if (navigator.userAgent.indexOf("NT 6.2") == -1) {
		function googleTranslateElementInit() {
	  new google.translate.TranslateElement({pageLanguage: 'en', includedLanguages: 'en,de,fr,it,es,pt,ru,uk,ar,zh-CN,zh-TW,ko,iw,hi,ja,tr', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element');
		}						}
	</script>
	<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit">
	</script>
</div>		
<div id="main">

<h1>Step Response Screen</h1>

<p><map name="FPMap1">
<area href="#PID" shape="rect" coords="4, 31, 241, 76">
<area href="#max_limits" shape="rect" coords="19, 80, 211, 174">
<area href="#Motion_Profile" shape="rect" coords="9, 178, 134, 280">
<area href="#Feed_Forward" shape="rect" coords="132, 175, 243, 258">
<area href="#Axis_Control" shape="rect" coords="144, 255, 247, 365">
<area href="#Dead_Band" shape="rect" coords="10, 282, 149, 370">
<area href="#Measurement" shape="rect" coords="32, 366, 216, 485">
<area href="#Save/Load_Data" shape="rect" coords="112, 486, 225, 566">
<area href="#drop_down_list" shape="rect" coords="377, 30, 864, 69">
<area href="#Step_Response_Screen" shape="rect" coords="279, 66, 892, 564">
</map></p>
	
<p class="small"><img src="StepScreen.PNG" width="897" height="580" usemap="#FPMap1" alt="StepScreen" /><br />
Click on above image to jump to relative topic.</p>

<p>The <a name="Step_Response_Screen"> <strong><em>Step Response Screen</em></strong></a> allows changes to system 
tuning parameters and allows measurement and graphs of the system's time 
response for either a Move Profile or a Step Function. The graph shown 
above is of an applied step function of 400 counts. The graphs shown below 
are of a profiled move (and back) of 400 counts. The first has the Output 
drive hidden and the second has the Output drive displayed. Click on the 
graphs for a larger view. Note that the Output drive signal contains large 
spikes. This is the result of quantization error in the measured position. 
Quantization error in the measured position makes it appear to the system as if 
there was no motion, and then suddenly as if there was a relatively quick motion 
of one count in a single servo sample cycle. This is a
<a href="../BodeScreen/BodeScreen.htm#linear">non-linear effect</a>. In 
some cases these &quot;spikes&quot; may exceed the output range causing saturation a still 
further non-linear effect. A low pass filter may be used to &quot;smooth&quot; the 
output, see the <a href="../FilterScreen/FilterScreen.htm">IIR Filter Screen</a>, 
but has limits. Attempting too much &quot;smoothing&quot; by setting a lower 
frequency will eventually have an effect on the performance of the system, 
reducing the <a href="../BodeScreen/BodeScreen.htm#phase_margin">phase margin</a>. 
Normally, the cutoff frequency of the low pass filter should be significantly 
larger than the system bandwidth.</p>

<p><a href="MoveGraphBig.PNG"><img src="MoveGraph.PNG" width="449" height="290" alt="MoveGraph" /></a></p>
<p><a href="MoveGraphOutputBig.PNG"><img src="MoveGraphOutput.PNG" width="449" height="290" alt="MoveGraphOutputBig" /></a></p>

<p>There are three basic time domain plot types that may be selected from the
<a name="drop_down_list">drop down list</a>, which are shown below.</p>
<p><img src="StepSc1.gif"></p>
<p>They consist of either:</p>

<ol>
  <li>Commanded Position, Measured Position, and Motor Output</li>
  <li>Position Error and Motor Output</li>
  <li>Commanded Velocity, Measured Velocity, and Motor Output</li>
</ol>

<p>For all three plot types the Motor Output is always displayed as a secondary
<em>Y</em> axis on the right side of the graph. The other plotted values are 
on the primary left <em>Y</em> axis. The <em>X</em> axis is always time in 
seconds. After a particular plot type has been selected, each individual 
plot variable may be displayed or hidden by selecting the checkbox with the 
corresponding name (and color) of the variable.</p>

<p>Any portion of the graph may be zoomed by left-click dragging across the 
graph. Simply select the area of interest. Right clicking on the graph 
will bring up a context menu that allows zooming out completely or to the 
previous zoom level.</p>

<p>Below is an example of a graph of <em>Position Error </em>(for the same 400 
count move shown above)<em>.</em> Position Error is defined as Measured 
Position - Commanded Position. The same data as that is plotted in the 
Command/Position plots is used, however instead of plotting both values, the 
difference is plotted. Note that because the Measured Position is 
quantized to integer encoder counts, the quantization effect is also observed in 
the Position Error.</p>

<p><map name="FPMap0">
<area href="PosErrorGraphBig.PNG" shape="rect" coords="3, 6, 447, 287"></map>
<img src="PosErrorGraph.PNG" width="449" height="290" usemap="#FPMap0" alt="PosErrorGraph" /></p>

<p>The third type of plot displays the Velocity of the Commanded and/or Measured 
Position. Velocity units are <em>Position</em> <em>Units</em> per second. 
When a Move is commanded, a motion profile is computed which achieves the motion 
in the shortest time without exceeding the maximum allowed velocity, 
acceleration, or jerk. Because the Command is a theoretical profile 
computed using floating point arithmetic, it is very smooth. The blue graph 
immediately below shows such a plot. In a velocity graph, <em>slope</em> in 
the graph represents acceleration. In this case a relatively low value specified 
for maximum jerk causes the changes in slope to be gradual. The 
second plot below is the same data but with the <em>Measured</em> velocity 
displayed along with the Commanded velocity. Because of encoder resolution 
limitations, measured velocity calculated using a simple position difference per 
sample period tends to be highly quantized as shown. In this example even 
at our peak velocity at ~ 23,000 position counts per second this results in a 
maximum of only 3 position counts per servo sample period.</p>

<p><a href="VelCmdOnlyGraphBig.PNG">
<img src="VelCmdOnlyGraph.PNG" width="449" height="290" alt="VelCmdOnlyGraph" /></a></p>
<p><a href="VelGraphBig.PNG">
<img src="VelGraph.PNG" width="449" height="290" alt="VelGraph" /></a></p>

<p>The velocity graph below, shows the effect of setting the maximum allowed 
jerk to a very large value (100X higher than the graph above). Note how 
the slope of the velocity changes abruptly which represents a high rate of 
change of acceleration (jerk).</p>

<p><a href="VelCmdOnlyHiJerkGraphBig.PNG">
<img src="VelCmdOnlyHiJerkGraph.PNG" width="449" height="290" alt="VelCmdOnlyHiJerkGraph" /></a></p>

<a name="PID"></a><h3>Tuning Parameters - PID</h3>

<div style="float: left; margin-right: 30px;">
<img src="StepSc2.gif" alt="PID" />
</div>
<p>The PID (proportional, integral, and derivative) gains set the amount of feedback of 
the error itself (proportional), the integration of the error (integral), and 
the derivative of the position (derivative) that is applied to the output. 
Also see the <a href="../ServoFlowDiagram.htm">KMotion Servo Flow Diagram</a>.</p>

<p>The units of the proportional gain are in Output Units/Position Units. 
For example if the Position Units are in encoder counts, and the Output Units 
are in <a href="../AnalogIOScreenKFLOP/AnalogIOScreen.htm#PWMs">PWM counts</a>, then 
a gain of 10.0 would apply an output drive of 10 PWM for an error of 1 encoder 
count.</p>

<p>The units of the integral gain are in Output Units/Position Units per <em>
Servo Sample Time</em>. <em><strong>KMotion's</strong> <a name="Servo_Sample_Time">Servo Sample Time</a></em> 
is fixed at 90µs. An integrator basically sums the position error every servo sample. For example, with an 
integral gain of 10, and an error of 1 encoder count for 5 servo samples, an 
output drive of 50 PWM counts would be applied Integrator gain is normally 
used to achieve high accuracy. This is because even a very small error 
will eventually integrate to a large enough value for there to be an corrective 
action. In fact, having any integrator gain at all guarantees a steady 
state error (average error) of zero. This effect also guarantees that 
there will always be some overshoot in response to a step function, otherwise 
the average error could not be equal to zero.</p>

<p>The units of the derivative gain are in Output Units/Position Units x <em>
Servo Sample Time</em>. The derivative term is simply the change in 
position from one servo sample to the next. For example, with a derivative 
gain of 10, and a position change of 1 encoder count from the previous servo 
sample, an output drive of -10 PWM counts would be applied. The negative 
sign shows that the output is applied in a manner to oppose motion. Derivative 
gain has the effect of applying damping, which is a force proportional and 
opposite to the current velocity. Although derivative gain is often used 
successfully in a control system, consider using a lead/lag filter which 
performs in a similar manner, but doesn't have the undesirable feature of 
increasing gain at high frequencies.</p>

<a name="max_limits"></a><h3>Tuning Parameters - max limits</h3>

<div style="float: left; margin-right: 30px;">
<img src="StepSc3.gif" alt="Max Limits" />
</div>

<p><em><strong>KMotion's</strong></em> <em>max limits</em> allow several points in the
<a href="../ServoFlowDiagram.htm">Servo Flow Diagram</a> to be clamped, or 
limited to a specified range. The limits in the flow diagram are shown as 
a clamp symbol<img src="StepSc9.gif" />. This capability is often 
useful in controlling how the system responds to extreme situations.</p>
<p>Maximum <em>output</em> limit is used to limit the maximum applied value, in 
counts, to the output drive. The output drive may be either one of 
the on-board <a href="../AnalogIOScreenKFLOP/AnalogIOScreen.htm#PWMs">PWM outputs</a> 
or a <a href="../AnalogIOScreenKFLOP/AnalogIOScreen.htm#DACs">DAC value</a> that 
drives an external amplifier. </p>

<p>Maximum <em>integrator</em> limit is used to restrict the maximum value of the 
integrator. This effect is often used to avoid an effect referred to as 
integrator &quot;<em>wind up</em>&quot;. Without any integrator limit, consider the 
case where somehow a substantial error is maintained for a significant period of 
time. For example turning a motor shaft by hand for several seconds. 
During this time the integrator would ramp up to an extremely large value. 
When the motor shaft was released, it would accelerate at maximum and overshoot 
the target by a huge amount until the integrator could ramp back down to a 
reasonable value. This often results in a servo slamming into a limit. 
The maximum integrator limit prevents this from occurring. Often the main 
purpose for using an integrator is to overcome static friction in order to 
reduce the final error to zero. This usually requires only a small 
fraction of total output range. In almost all cases it is of no value to 
allow the integrator to exceed the maximum output value.</p>

<p>Maximum <em>error</em> limits the maximum value allowed to pass through the 
servo compensator. The units are the same as position units. 
Typically, when a servo loop is operating normally, its following error is a 
small value. When some extreme even occurs, such as a sudden large step 
command, or possibly a large disturbance the error may become very large. 
In some cases there may be benefit to limiting the error to a reasonable value.</p>

<h2>Tuning Parameters - <a name="Motion_Profile">Motion Profile</a></h2>

<div style="float: left; margin-right: 30px;">
<img src="StepSc11.gif" alt="Motion Profile" />
</div>
<p>The Motion Profile parameters set the maximum allowed velocity (in position 
units per second), the maximum allowed acceleration (in position units per 
second<sup>2</sup>), and the maximum allowed jerk (in position units per second<sup>3</sup>). 
These parameters will be utilized for any independent (non coordinated motion) 
move command for the axis. The acceleration and jerk also apply to jog 
commands (move at continuous velocity) for the axis.</p>

<h2>Tuning Parameters - <a name="Feed_Forward">Feed Forward</a></h2>

<div style="float: left; margin-right: 30px;">
<img src="StepSc4.gif" alt="Fedd Forward" /></a>
</div>

<p><em><strong>KMotion's</strong></em> <em>Feed Forward</em> may often be used to dramatically 
reduce the following error in a system. See the
<a href="../ServoFlowDiagram.htm">Servo Flow Diagram</a> to see precisely how it 
is implemented. The idea behind feed forward is to observe the 
velocity and acceleration of the command signal and anticipate a required output 
and to apply it without waiting for an error to develop. </p>

<p>Most motion systems are constructed in manner where some sort of motor force 
is used to accelerate a mass. In these cases whenever an acceleration is 
required a force proportional to the acceleration will be required to achieve 
it. Acceleration feed forward may be used to reduce the amount that the 
feedback loop must correct. In fact, proper feed forward reduces the 
requirement on the feedback from the total force required to accelerate the 
mass, to only the variation in the force required to accelerate the mass. </p>

<p>Similarly most servo systems require some amount of force that is 
proportional to velocity simply to maintain a constant velocity. This 
might be due to viscous friction, or possibly motor back emf (electro motive 
force). In any case velocity feed forward may be used to reduce the 
demands of the feedback loop resulting in smaller following error.</p>

<p>The normal procedure to optimize feed forward is to select plot type - 
position error, and measure moves using the <em>Move Command</em> (Step functions 
should <em>not</em> be used as step functions are instantaneous changes in 
position that represent infinite velocity and acceleration). </p>

<p>Note that in the <a href="../ServoFlowDiagram.htm">Servo Flow Diagram</a> the 
feed forward is injected <em>before</em> the final
<a href="../FilterScreen/FilterScreen.htm">IIR Filter</a>. This allows any 
feed forward waveforms to be conditioned by this filter. Feed forward 
pulses may be relatively sharp pulses to make rapid accelerations that may often 
tend to disturb a mechanical resonance in the system. Usually a system 
with a sharp resonance will benefit from a notch filter to improve the stability 
and performance of the servo loop. By placing the notch filter as the last 
filter in the servo loop, the feed forward waveform will also pass through this 
filter and the result is that the feed forward will cause less excitation of the 
mechanism than it would otherwise.. </p>

<h2>Tuning Parameters - <a name="Dead_Band">Dead Band</a></h2>

<div style="float: left; margin-right: 30px;">
<img src="StepSc5.gif" alt="Dead Band" />
</div>

<p>Dead band is used to apply a different gain to the region near zero than the 
rest of the region. Usually either zero gain or a gain much less than 1 is 
used within the dead band range. See the
<a href="../ServoFlowDiagram.htm">Servo Flow Diagram</a> for the exact location 
of where the dead band is inserted. Dead band is a means of introducing 
&quot;slop&quot; into a system. This usually results in less accuracy and 
performance, but may reduce or eliminate limit cycle oscillations while resting 
at the target position. </p>

<p>The values shown (range = 0, gain = 1) are used to defeat any dead band. The 
chart below shows the resulting input/output for range = 2, gain = 0. The slope 
of the graph is always 1 outside of the specified +/- range, and the specified 
gain with the +/- range.</p>

<p><img src="StepSc10.gif" alt="Dead Band" /></p>

<h2><a name="Measurement">Measurement</a></h2>

<div style="float: left; margin-right: 30px;">
<img src="StepSc6.gif" alt="Measurment" />
</div>
<p> To perform a measurement and display the response, select the time duration to 
gather data, and the move or step size to perform, and press either the Move or 
Step buttons. If the axis is currently enabled, it will be disabled, all 
parameters from all screens will be downloaded, the axis will be enabled, the 
move or step will be performed while the data is gathered, the data will 
then be uploaded and plotted.</p>

<p>A <em>Move</em> will hold position for a short time, perform a motion of the 
specified amount from the current location, pause for a short time, and then a 
second motion back to the original location.</p>
<p>A <em>Step</em> will hold position for a short time, perform a step of the 
specified amount from the current location, pause for a short time, and then a 
second step back to the original location.</p>
<p>The maximum time that data may be collected is 3.5 seconds (3.5 seconds / 90µs 
= 38,888 data points). Note that collecting data at this rate allows 
zooming while still maintaining high resolution.</p>

<h2><a name="Axis_Control">Axis Control</a></h2>

<div style="float: left; margin-right: 30px;">
<img src="StepSc7.gif" alt="Axis Control" />
</div>
<p>The Axis Control buttons are present to conveniently disable (Kill), Zero, or 
Enable an axis. If the axis becomes unstable (possible due to a gain 
setting too high), the Kill button may be used to disable the axis, the gain 
might then be reduced, and then the axis may be enabled. The Enable button 
downloads all parameters from all screens before enabling the axis in the same 
manner as the <em><a href="#Measurement">Measurement</a></em> buttons described above.</p>
<p><em>Note for brushless output modes that commutate the motor based on the 
current position, Zeroing the position may adversely affect the commutation.</em></p>

<h2><a name="Save/Load_Data">Save/Load Data</a></h2>

<div style="float: left; margin-right: 30px;">
<img src="StepSc8.gif" align="left" hspace="10" vspace="10">
</div>

<p>The Save/Load Data buttons allow the captured Step Plot to be saved to a text file 
and re-loaded at a later time. The text file format also allows the data 
to be imported into some other program for display or analysis. The file 
format consists of one line of header followed by one line of 5 comma separated 
values, one line for each sample. The values are:</p>

<ol>
  <li>Sample Number</li>
  <li>Time, Seconds</li>
  <li>Command</li>
  <li>Position</li>
  <li>Output</li>
</ol>

<p>Example of data file follows:</p>

<pre>
Sample	Time		Command	Position	Output
0	0		5	5		-0.3301919
1	9e-005		5	5		-0.3300979
2	0.00018		5	5		-0.3300258
3	0.00027		5	5		-0.3299877
4	0.00036		5	5		-0.3299999
5	0.00045		5	5		-0.3300253
6	0.00054		5	5		-0.3300359
7	0.00063		5	5		-0.3300304
8	0.00072		5	5		-0.3300199
9	0.00081		5	5		-0.3300156
10	0.0009		5	5		-0.3300157
62
.
.
.
</pre>
<p>&nbsp;</p>
</div>

</body>

</html>
