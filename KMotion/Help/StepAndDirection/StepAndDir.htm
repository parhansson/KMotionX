<!DOCTYPE html>
<html>
<head>

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>

<meta name="keywords" content="cnc control, motion control, cnc boards, 4-axis, 8-axis, stepper, brushless, DC motor, servo, encoder, adc, dac, motion controller, automated motion, manufacturing, Mach3">
<meta name="description" content="Manufacturer of premium motion control products for CNC Manufacturing, Robotics and Automation">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta http-equiv="Content-Language" content="en-us">

<title>Step and Direction Setup</title>

<link rel="stylesheet" type="text/css" href="../css/style.css">
<link rel="stylesheet" href="../css/prism.css" data-noprefix />
<script src="../js/prism.js"></script>
</head>

<body>

<div id="logo"><a href="../index.htm"></a></div>

<div id="home">
<a href="../index.htm">Table of contents</a> |  
	<script>
		if (navigator.userAgent.indexOf("NT 6.2") == -1){
			document.write('<a href="https://www.dynomotion.com">Dynomotion home page</a>')
		} else {
			document.write('<a href="https://www.dynomotion.com" target="_blank">Dynomotion home page</a>')
		}
	</script>
</div>
	
<div id="searchNav">

	<div class="gcse-search">
					<script>
					  if (document.location.protocol  ==  'https:') {
					  (function() {
					  var cx = '012657033059195044748:9fmjmlufts0';
					  var gcse = document.createElement('script');
					  gcse.type = 'text/javascript';
					  gcse.async = true;
					  gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					      '//cse.google.com/cse.js?cx=' + cx;
					  var s = document.getElementsByTagName('script')[0];
					  s.parentNode.insertBefore(gcse, s);
					})();
					  }
				      </script> 
				      <gcse:search> </gcse:search>  

	       </div>
</div>	

	


<div id="google_translate_element" style="background: transparent;" align="right"><script type="text/javascript">
if (navigator.userAgent.indexOf("NT 6.2") == -1) {
		function googleTranslateElementInit() {
	  new google.translate.TranslateElement({pageLanguage: 'en', includedLanguages: 'en,de,fr,it,es,pt,ru,uk,ar,zh-CN,zh-TW,ko,iw,hi,ja,tr', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element');
		}						}
	</script>
	<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit">
	</script>
</div>		
<div id="main">

<h1>Configuring Step and Direction Outputs</h1>
<p>KFLOP supports connection to motor amplifiers that utilize step and 
  direction (or <a href="#Quadrature">quadrature</a> or <a href="#CW/CCW">CW/CCW Pulses</a>) 
  inputs to control the motion. Step and direction motor 
  amplifiers are typically used with stepper motors with or without micro-stepping 
  capability. Each &quot;step&quot; causes the motor amplifier to advance the motor 
  position one step in the direction specified by the &quot;Direction&quot; signal. 
  Only two digital output signals are required for this interface. 
  Fine micro-stepping resolution combined with high motor RPM can result in step 
  rates in the megahertz. For example, a 200 step/rev stepping motor 
  with 128:1 micro-stepping running at 3000 RPM requires:</p>

<p><em>3000 RPM / 60 Sec/Min * 200 steps/rev * 128 µsteps/full step = 1.28 MHz
µsteps/sec</em></p>

<p>KFLOP has 8 axes of Step and Direction. Output pulses up to 2.5 MHz can be generated. </p>
<p>The 8 Axes of Step/Dir outputs are normally hard wired to IO bits 8 through 
15 on JP7 and IO bits 36 through 43 on JP5. However the first 4 Step/Dir 
outputs can be multiplexed to connectors JP4 and JP6 if desired. This may 
be required if JP7 is used for some other purpose such as interfacing to the 
Kanalog I/O Expander. A global <a href="#Global_Register">multiplexing bit</a> is used to switch the 
outputs to the alternate connectors. </p>

<p>Note that the first 8 of 10 I/O pins of Aux #0 and Aux #1 have internal 150 
Ohm pull down resistors. Therefore Pins JP4-13, JP4-14, JP6-13 and JP6-14 
may not be used in Open Collector mode. </p>
<p>If an axis channel is selected as a Step and Direction axis, the 
corresponding 2 output pins will be automatically configured as outputs and they 
may not be used as general purpose IO.</p>

<p>For KFLOP see the table below:</p>

	<table class="tableSmall">
		<tr>
			<th></th>
			<th colspan="2">Mux = 0</th>
			<th colspan="2">Mux = 1</th>
		</tr>
		<tr>
			<th class="subheader">Signal</th>
			<th class="subheader">IO Bit</th>
			<th class="subheader">Pin</th>
			<th class="subheader">IO Bit</th>
			<th class="subheader">Pin</th>
		</tr>
		<tr>
			<td>Step 0</td>
			<td>8</td>
			<td>JP7 - 15</td>
			<td>22</td>
			<td>JP4 - 13</td>
		</tr>
		<tr>
			<td>Direction 0</td>
			<td>9</td>
			<td>JP7 - 16</td>
			<td>23</td>
			<td>JP4 - 14</td>
		</tr>
		<tr>
			<td>Step 1</td>
			<td>10</td>
			<td>JP7 - 17</td>
			<td>24</td>
			<td>JP4 - 15</td>
		</tr>
		<tr>
			<td>Direction 1</td>
			<td>11</td>
			<td>JP7 - 18</td>
			<td>25</td>
			<td>JP4 - 16</td>
		</tr>
		<tr>
			<td>Step 2</td>
			<td>12</td>
			<td>JP7 - 19</td>
			<td>32</td>
			<td>JP6 - 13</td>
		</tr>
		<tr>
			<td>Direction 2</td>
			<td>13</td>
			<td>JP7 - 20</td>
			<td>33</td>
			<td>JP6 - 14</td>
		</tr>
		<tr>
			<td>Step 3</td>
			<td>14</td>
			<td>JP7 - 21</td>
			<td>34</td>
			<td>JP6 - 15</td>
		</tr>
		<tr>
			<td>Direction 3</td>
			<td>15</td>
			<td>JP7 - 22</td>
			<td>35</td>
			<td>JP6 - 16</td>
		</tr>
		</table>
	<p></p>
	<table class="tableSmall">
		<tr>
			<th>Signal</th>
			<th>IO Bit</th>
			<th>JP5 Pin</th>
		</tr>
		<tr>
			<td>Step 4</td>
			<td>36</td>
			<td>JP5 - 1</td>
		</tr>
		<tr>
			<td>Direction 4</td>
			<td>37</td>
			<td>JP5 - 2</td>
		</tr>
		<tr>
			<td>Step 5</td>
			<td>38</td>
			<td>JP5 - 3</td>
		</tr>
		<tr>
			<td>Direction 5</td>
			<td>39</td>
			<td>JP5 - 4</td>
		</tr>
		<tr>
			<td>Step 6</td>
			<td>40</td>
			<td>JP5 - 5</td>
		</tr>
		<tr>
			<td>Direction 6</td>
			<td>41</td>
			<td>JP5 - 6</td>
		</tr>
		<tr>
			<td>Step 7</td>
			<td>42</td>
			<td>JP5 - 7</td>
		</tr>
		<tr>
			<td>Direction 7</td>
			<td>43</td>
			<td>JP5 - 8</td>
		</tr>
	</table>

<p>To configure an axis as step and direction, on the Configuration Screen   select output mode as "Step Dir" and select which of the 8 available   Step and Direction generators should be used by setting the appropriate   Output Channel 0 setting. See below.</p>

<p><img src="ConfigStepDir.PNG" width="507" height="515" alt="ConfigStepDir" /></p>

<p>Valid output channel settings 0-63 are allowed for KFLOP. Although only   8 Step and Direction generators are available for KFLOP by adding 8   and/or 16 and/or 48 to the channel number the mode of each Step/Dir   Generator can be changed independently. <br>
  <br>
  Adding 8 to the channel number uses the same generator to be used except   the output pins are actively driven (high and low) as 3.3V LVTTL signals   instead of only driven low as open collector outputs. <br>
  <br>
  Adding 16 to the channel number switches the generator from Step/Dir to   Quadrature output mode. <br>
  <br>
  Adding 48 to the channel number switches the generator from Step/Dir to   CW/CCW output mode. </p>

<p>If your amplifier has opto coupler inputs driven off +5V then open-collector mode is likely to work better. The diagram below shows how the open collector mode works driving the LED of an Opto Coupler with the anode connected to +5V.</p>

<p><img src="OpenCollector.PNG" width="450" height="280" alt="OpenCollector" /></p>

<p>However if the amplifier has standard logic inputs then LVTTL outputs should work better. </p>

<p><a name="Quadrature">Quadrature</a> outputs are required for some amplifiers. 
Quadrature outputs output two A B phases instead of Step/Dir signals. An 
advantage is that only one signal edge transition takes place for each &quot;step&quot; as 
opposed to a complete pulse and any Direction Setup Time and Minimum pulse time 
is avoided. Quadrature mode is selected by adding 16 to the Output Channel 
Number.</p>

<p><a name="CW/CCW">CW/CCW</a> Mode is also available. In this mode instead of having a 
Direction signal there is a separate output for CW and CCW Pulses. This 
mode avoids any Direction Setup Time as well. CW/CCW mode is selected by 
adding 48 to the Output Channel Number.</p>

<p><img src="AllModes.png" width="647" height="623" alt="AllModes" /></p>

<p>The table below summarizes the Channel Number to specify to access the desired Generator and Mode:</p>
	
	<table class="tableMedium">
		<tr>
			<th class="col20">Output Chan 0 Setting</th>
			<th class="col20">Step &amp; Dir Generator Selected</th>
			<th class="col60">Output Drive Type</th>
		</tr>
		<tr>
			<td>0</td>
			<td>0</td>
			<td>Open Collector - Step/Dir</td>
		</tr>
		<tr>
			<td>1</td>
			<td>1</td>
			<td>Open Collector - Step/Dir</td>
		</tr>
		<tr>
			<td>2</td>
			<td>2</td>
			<td>Open Collector - Step/Dir</td>
		</tr>
		<tr>
			<td>3</td>
			<td>3</td>
			<td>Open Collector - Step/Dir</td>
		</tr>
		<tr>
			<td>4</td>
			<td>4</td>
			<td>Open Collector - Step/Dir</td>
		</tr>
		<tr>
			<td>5</td>
			<td>5</td>
			<td>Open Collector - Step/Dir</td>
		</tr>
		<tr>
			<td>6</td>
			<td>6</td>
			<td>Open Collector - Step/Dir</td>
		</tr>
		<tr>
			<td>7</td>
			<td>7</td>
			<td>Open Collector - Step/Dir</td>
		</tr>
		<tr>
			<td>8</td>
			<td>0</td>
			<td>LVTTL - Step/Dir</td>
		</tr>
		<tr>
			<td>9</td>
			<td>1</td>
			<td>LVTTL - Step/Dir</td>
		</tr>
		<tr>
			<td>10</td>
			<td>2</td>
			<td>LVTTL - Step/Dir</td>
		</tr>
		<tr>
			<td>11</td>
			<td>3</td>
			<td>LVTTL - Step/Dir</td>
		</tr>
		<tr>
			<td>12</td>
			<td>4</td>
			<td>LVTTL - Step/Dir</td>
		</tr>
		<tr>
			<td>13</td>
			<td>5</td>
			<td>LVTTL - Step/Dir</td>
		</tr>
		<tr>
			<td>14</td>
			<td>6</td>
			<td>LVTTL - Step/Dir</td>
		</tr>
		<tr>
			<td>15</td>
			<td>7</td>
			<td>LVTTL - Step/Dir</td>
		</tr>
		<tr>
			<td>16</td>
			<td>0</td>
			<td>Open Collector - Quadrature</td>
		</tr>
		<tr>
			<td>17</td>
			<td>1</td>
			<td>Open Collector - Quadrature</td>
		</tr>
		<tr>
			<td>18</td>
			<td>2</td>
			<td>Open Collector - Quadrature</td>
		</tr>
		<tr>
			<td>19</td>
			<td>3</td>
			<td>Open Collector - Quadrature</td>
		</tr>
		<tr>
			<td>20</td>
			<td>4</td>
			<td>Open Collector - Quadrature</td>
		</tr>
		<tr>
			<td>21</td>
			<td>5</td>
			<td>Open Collector - Quadrature</td>
		</tr>
		<tr>
			<td>22</td>
			<td>6</td>
			<td>Open Collector - Quadrature</td>
		</tr>
		<tr>
			<td>23</td>
			<td>7</td>
			<td>Open Collector - Quadrature</td>
		</tr>
		<tr>
			<td>24</td>
			<td>0</td>
			<td>LVTTL - Quadrature</td>
		</tr>
		<tr>
			<td>25</td>
			<td>1</td>
			<td>LVTTL - Quadrature</td>
		</tr>
		<tr>
			<td>26</td>
			<td>2</td>
			<td>LVTTL - Quadrature</td>
		</tr>
		<tr>
			<td>27</td>
			<td>3</td>
			<td>LVTTL - Quadrature</td>
		</tr>
		<tr>
			<td>28</td>
			<td>4</td>
			<td>LVTTL - Quadrature</td>
		</tr>
		<tr>
			<td>29</td>
			<td>5</td>
			<td>LVTTL - Quadrature</td>
		</tr>
		<tr>
			<td>30</td>
			<td>6</td>
			<td>LVTTL - Quadrature</td>
		</tr>
		<tr>
			<td>31</td>
			<td>7</td>
			<td>LVTTL - Quadrature</td>
		</tr>
		<tr>
			<td>32</td>
			<td>0</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>33</td>
			<td>1</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>34</td>
			<td>2</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>35</td>
			<td>3</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>36</td>
			<td>4</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>37</td>
			<td>5</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>38</td>
			<td>6</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>39</td>
			<td>7</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>40</td>
			<td>0</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>41</td>
			<td>1</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>42</td>
			<td>2</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>43</td>
			<td>3</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>44</td>
			<td>4</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>45</td>
			<td>5</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>46</td>
			<td>6</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>47</td>
			<td>7</td>
			<td>reserved</td>
		</tr>
		<tr>
			<td>48</td>
			<td>0</td>
			<td>Open Collector - CW/CCW</td>
		</tr>
		<tr>
			<td>49</td>
			<td>1</td>
			<td>Open Collector - CW/CCW</td>
		</tr>
		<tr>
			<td>50</td>
			<td>2</td>
			<td>Open Collector - CW/CCW</td>
		</tr>
		<tr>
			<td>51</td>
			<td>3</td>
			<td>Open Collector - CW/CCW</td>
		</tr>
		<tr>
			<td>52</td>
			<td>4</td>
			<td>Open Collector - CW/CCW</td>
		</tr>
		<tr>
			<td>53</td>
			<td>5</td>
			<td>Open Collector - CW/CCW</td>
		</tr>
		<tr>
			<td>54</td>
			<td>6</td>
			<td>Open Collector - CW/CCW</td>
		</tr>
		<tr>
			<td>55</td>
			<td>7</td>
			<td>Open Collector - CW/CCW</td>
		</tr>
		<tr>
			<td>56</td>
			<td>0</td>
			<td>LVTTL - CW/CCW</td>
		</tr>
		<tr>
			<td>57</td>
			<td>1</td>
			<td>LVTTL - CW/CCW</td>
		</tr>
		<tr>
			<td>58</td>
			<td>2</td>
			<td>LVTTL - CW/CCW</td>
		</tr>
		<tr>
			<td>59</td>
			<td>3</td>
			<td>LVTTL - CW/CCW</td>
		</tr>
		<tr>
			<td>60</td>
			<td>4</td>
			<td>LVTTL - CW/CCW</td>
		</tr>
		<tr>
			<td>61</td>
			<td>5</td>
			<td>LVTTL - CW/CCW</td>
		</tr>
		<tr>
			<td>62</td>
			<td>6</td>
			<td>LVTTL - CW/CCW</td>
		</tr>
		<tr>
			<td>63</td>
			<td>7</td>
			<td>LVTTL - CW/CCW</td>
		</tr>
	</table>

<p>Note when configuring the motion profile for a Step and Direction Axis the appropriate maximum Velocity, Acceleration, and Jerk should be set in units of micro-steps/sec, micro-steps/sec<sup>2</sup>, and micro-steps/sec<sup>3</sup> respectively.</p>

<h2><a name="Global_Register">Global Register</a> sets Pulse Width, Polarity, Multiplexor</h2>

<p>To change the Step/Dir Pulse width, Step Pulse Polarity, and connector multiplexor for channels 0-3 a programmable register in KFLOP's FPGA may be used. </p>

<p>KFLOP has the capability to program the Step pulse width as a 6-bit value. The default setting is 2us. The pulse length may be adjusted from 1 to 63 of 16.67 MHz clocks. Which corresponds to 60ns to 3.78us. Using a long pulse length limits the maximum frequency that can be generated. For example with the default pulse length of 2us the frequency should not exceed 1/(2 x 2us) = 250KHz. </p>

<p>KFLOP sets the Direction output 1.92us before generating a Step Pulse. With the maximum Step Pulse length of 3.78us the maximum Direction Setup time to the trailing edge of the Step Pulse is 5.7us. </p>

<p>Setting Bit-6 high of the register can be set high to multiplex Step/Dir generators 0-3 from JP7 to JP4 and JP6.</p>

<p>Setting Bit-7 high will invert the Step Output pulse so that it pulses High rather than Low. Some Amplifiers (Geckos) prefer this mode. If the drive &quot;steps&quot; on the falling edge of the pulse, then this option will provide more setup time for the Direction Signal. </p>

<p>A User C Program must be used to change the FPGA register. The following statement should be used:</p>

<pre>
	<code class="language-c">
	FPGA(STEP_PULSE_LENGTH_ADD)=32;					// set the pulse time to ~ 2&mu;s
	FPGA(STEP_PULSE_LENGTH_ADD)=32 + 0x40;			// set the pulse time to ~ 2&mu;s and multiplex to JP4 and JP6
	FPGA(STEP_PULSE_LENGTH_ADD)=32 + 0x80;			// set the pulse time to ~ 2&mu;s and pulse the Step High
	FPGA(STEP_PULSE_LENGTH_ADD)=32 + 0x40 + 0x80 	// set the pulse time to ~ 2&mu;s, mux to JP4 and JP6, and pulse the Step High
	</code>
</pre>

<h2>Example Configuration for a IM804 Amplifier and Rapidsyn Stepper</h2>
<p><img src="StepDirLayout.jpg" width="563" height="514" alt="StepDirLayout" /></p>

<h2>Layout - KMotion - Amplifier - Motor</h2>
<p><img src="IM804.jpg" width="522" height="347" alt="Amplifier - Motor" /></p>

<p>Amplifier Connections - resistors set coil currents (1500 ohms = 3A) and idle standby current (270 ohms = 0.5A). DIP Switches set 
to ON-OFF-OFF-ON for 128:1 micro-stepping.</p>

<p><img src="RapidsynMotor.JPG" width="336" height="493"></p>
<p>Rapidsyn stepper motor. Note coil winding's centertaps are not used.</p>

<p><img src="ConfigStepDir.PNG" width="507" height="515"></p>
<p>Axis channel 0 configures as &quot;Step Dir&quot; mode and using Step and Direction generator 0.</p>

<p><img src="MoveResponse.PNG" width="897" height="580"></p>
<p>Max Velocity 1.6 x 10<sup>6</sup> steps/sec (1.6e6 / 128 = 12,500 sps = 
3750 RPM). Note this (and most) steppers lose most all of their useful 
torque above several thousand full steps per second. The high speed 
demonstrated here is intended to demonstrate KMotion's ability to generate high 
pulse rates.</p>

<p>Max Acceleration 6 x 10<sup>6</sup> steps/sec<sup>2</sup>.</p>
<p>Max Jerk 2 x 10<sup>8</sup> steps/sec<sup>3</sup>.</p>
<p>1 x 10<sup>6</sup> count Move performed and data captured over 3 seconds.</p>
<p>Pushing Move downloads all parameters, enables the axis, performs the movement, and plots the result.</p>

<p><img src="DiditalStepOutputs.PNG" width="284" height="358"></p>
<p>Note after the axis has been enabled, digital IO bits 8 and 9 have 
automatically been configured as outputs for use by Step and Direction Generator 
#0.</p>

<p><a href="http://www.dynomotion.com/Videos/StepAndDir.wmv">Watch a video</a> showing 
slow and smooth acceleration of this configuration up to 12,500 
full steps per second (1.6 MHz @ 128 microsteps/full step). </p>

	<p>&nbsp;</p>

	</div>
</body>

</html>
